import{k as I,u as C,a as F,r as l,j as e,i as q,L as z}from"./index-CjXOYCek.js";import{u as B}from"./index.esm-DMDpr_Fp.js";import{I as h,E as w}from"./InputArea-Cnww-Nhg.js";import{E as v,a as y,n as P}from"./EmployeeServices-gydm101I.js";import{I as A,a as D}from"./forgot-password-office-dark-CQOqfqw9.js";import{L as k}from"./Loader-DOHrzpj0.js";const V=()=>{const{t:H}=I(),m=C(),E=F(),p=l.useRef(""),[R,c]=l.useState(!1),[d,g]=l.useState(""),[j,x]=l.useState(!1),[i,N]=l.useState(30);l.useEffect(()=>{var o;const r=new URLSearchParams(window.location.search).get("email");r?g(r):(o=m.state)!=null&&o.email&&g(m.state.email)},[m.state]),l.useEffect(()=>{let t=null;return i>0&&(t=setInterval(()=>{N(r=>r-1)},1e3)),()=>clearInterval(t)},[i]);const{register:u,handleSubmit:O,watch:S,formState:{errors:f}}=B();p.current=S("newPassword");const T=async({otp:t,newPassword:r})=>{var o,n,s,b;c(!0);try{const a=await v.resetEmployeePassword({email:d,otp:t,newPassword:r});y(a.message||"Password reset successful"),c(!1),setTimeout(()=>{E("/login")},1500)}catch(a){c(!1),P(((n=(o=a==null?void 0:a.response)==null?void 0:o.data)==null?void 0:n.message)||((b=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:b.error)||(a==null?void 0:a.message)||"Failed to reset password")}},L=async()=>{var t,r,o,n;try{x(!0);const s=await v.resendEmployeeForgotPasswordOtp({email:d});y(s.message||"OTP resent successfully"),x(!1),N(30)}catch(s){x(!1),P(((r=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:r.message)||((n=(o=s==null?void 0:s.response)==null?void 0:o.data)==null?void 0:n.error)||(s==null?void 0:s.message)||"Failed to resend OTP")}};return e.jsx("div",{className:"flex items-center min-h-screen p-6 bg-gray-50 dark:bg-gray-900",children:e.jsx("div",{className:"flex-1 h-full max-w-4xl mx-auto overflow-hidden bg-white rounded-lg shadow-md dark:bg-gray-800",children:e.jsxs("div",{className:"flex flex-col overflow-y-auto md:flex-row",children:[e.jsxs("div",{className:"h-32 md:h-auto md:w-1/2",children:[e.jsx("img",{"aria-hidden":"true",className:"object-cover w-full h-full dark:hidden",src:A,alt:"Office"}),e.jsx("img",{"aria-hidden":"true",className:"hidden object-cover w-full h-full dark:block",src:D,alt:"Office"})]}),e.jsx("main",{className:"flex items-center justify-center p-6 sm:p-12 md:w-1/2",children:e.jsxs("div",{className:"w-full",children:[e.jsx("h1",{className:"mb-4 text-xl font-semibold text-gray-700 dark:text-gray-200",children:"Reset Password"}),d?e.jsxs("form",{onSubmit:O(T),children:[e.jsxs("div",{className:"text-gray-700 dark:text-gray-300 mb-4",children:["Resetting password for: ",e.jsx("strong",{children:d})]}),e.jsx(h,{required:!0,register:u,label:"OTP",name:"otp",type:"text",placeholder:"Enter OTP Code"}),e.jsx(w,{errorName:f.otp}),e.jsx("div",{className:"mb-4",children:i>0?e.jsx("div",{className:"flex items-center",children:e.jsxs("p",{className:"text-sm text-emerald-500 dark:text-emerald-400",children:["Resend OTP in ",i," seconds"]})}):e.jsx("button",{type:"button",onClick:L,disabled:j,className:"text-sm font-medium text-emerald-500 dark:text-emerald-400 hover:underline",children:j?e.jsx("span",{className:"flex items-center",children:e.jsx(k,{size:"20"})}):"Resend OTP"})}),e.jsx(h,{required:!0,register:u,label:"New Password",name:"newPassword",type:"password",placeholder:"Enter New Password",className:"mb-4"}),e.jsx(w,{errorName:f.newPassword}),e.jsx("div",{className:"mb-4"}),e.jsx(h,{required:!0,register:u,label:"Confirm New Password",name:"confirmPassword",type:"password",placeholder:"Confirm New Password",validation:{validate:t=>t===p.current||"The passwords do not match"}}),e.jsx(w,{errorName:f.confirmPassword}),R?e.jsx("div",{className:"mt-4",children:e.jsx(k,{size:"40"})}):e.jsx(q.Button,{type:"submit",className:"mt-4 h-12 w-full",children:"Reset Password"})]}):e.jsx("div",{className:"text-red-500 mb-4",children:"Email not found. Please go back to the forgot password page."}),e.jsx("p",{className:"mt-4",children:e.jsx(z,{className:"text-sm font-medium text-emerald-500 dark:text-emerald-400 hover:underline",to:"/login",children:"Back to Login"})})]})})]})})})};export{V as default};
