import{j as e,r as d,i as t}from"./index-CjXOYCek.js";import{t as G,u as J,v as M,w as W,x as K,y as Q,z as S,A as X,N as Y,B as f}from"./Layout-mxREdH8E.js";import{P as Z}from"./PageTitle-DFA0mJ57.js";import{n as u,a as A}from"./EmployeeServices-gydm101I.js";const z=({id:m,name:b,type:n,handleClick:o,isChecked:j})=>e.jsx("input",{id:m,name:b,type:n,onChange:o,checked:j}),ee=({message:m="No data found",icon:b=e.jsx(G,{className:"h-12 w-12 text-gray-400"}),className:n="",children:o})=>e.jsxs("div",{className:`flex flex-col items-center justify-center text-center p-6 ${n}`,children:[e.jsx("div",{className:"mb-4",children:b}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",children:m}),o]}),ne=()=>{const[m,b]=d.useState([]),[n,o]=d.useState([]),[j,p]=d.useState(!1),[h,g]=d.useState(!1),[R,T]=d.useState(!1),[i,I]=d.useState("all"),[_,F]=d.useState(1),[v,ae]=d.useState(10),{setUpdated:k,markAllAsReadViaSocket:U,markAsReadViaSocket:B,socket:x,updated:P,fetchUnreadCount:y}=J(),$=m.length,N=m.slice((_-1)*v,_*v),L=s=>{F(s)},D=async s=>{var r,a;try{B(s)||await f.markAsRead(s),c(),k(!0)}catch(l){u(((a=(r=l==null?void 0:l.response)==null?void 0:r.data)==null?void 0:a.message)||(l==null?void 0:l.message))}},E=async s=>{var r,a;try{await f.deleteNotification(s),c(),k(!0)}catch(l){u(((a=(r=l==null?void 0:l.response)==null?void 0:r.data)==null?void 0:a.message)||(l==null?void 0:l.message))}},O=async()=>{var s,r;try{if(g(!0),n.length>0){for(const a of n)B(a)||await f.markAsRead(a);A("Selected notifications marked as read")}else U()||await f.markAllAsRead(),A("All notifications marked as read");o([]),p(!1),c(),k(!0)}catch(a){u(((r=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:r.message)||(a==null?void 0:a.message))}finally{g(!1)}},V=async()=>{var s,r;try{if(g(!0),n.length===0){u("Please select at least one notification to delete");return}for(const a of n)await f.deleteNotification(a);A("Selected notifications deleted successfully"),o([]),p(!1),c(),k(!0)}catch(a){u(((r=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:r.message)||(a==null?void 0:a.message))}finally{g(!1)}},H=()=>{p(!j),o(N==null?void 0:N.map(s=>s._id)),j&&o([])},q=s=>{const{id:r,checked:a}=s.target;o([...n,r]),a||o(n.filter(l=>l!==r))},c=async()=>{var s,r;try{g(!0);let l=(await f.getMyNotifications()).notifications;i==="read"?l=l.filter(C=>C.status==="read"):i==="unread"&&(l=l.filter(C=>C.status==="unread")),b(l)}catch(a){u(((r=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:r.message)||(a==null?void 0:a.message))}finally{g(!1)}},w=s=>{I(s),T(!1),F(1)};return d.useEffect(()=>{P&&(c(),k(!1))},[P]),d.useEffect(()=>{if(x)return x.on("new_notification",()=>{c(),y()}),x.on("notification_read",()=>{c(),y()}),x.on("all_notifications_read",()=>{c(),y()}),x.on("notification_deleted",()=>{c(),y()}),()=>{x.off("new_notification"),x.off("notification_read"),x.off("all_notifications_read"),x.off("notification_deleted")}},[x,c,y]),d.useEffect(()=>{c()},[i]),e.jsxs(e.Fragment,{children:[e.jsx(Z,{children:"Notifications"}),e.jsx(t.Card,{className:"shadow-md rounded-lg overflow-hidden bg-white dark:bg-gray-800 mb-5",children:e.jsxs(t.CardBody,{children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(t.Button,{disabled:h,onClick:O,className:"rounded-lg px-4 h-10 flex items-center justify-center bg-blue-600 text-white hover:bg-blue-700 transition-colors",children:[e.jsx(M,{className:"mr-2"}),"Mark as Read"]}),e.jsxs(t.Button,{disabled:(n==null?void 0:n.length)<1||h,onClick:V,className:"rounded-lg px-4 h-10 flex items-center justify-center bg-red-600 text-white hover:bg-red-700 transition-colors",children:[e.jsx(W,{className:"mr-2"}),"Delete Selected"]}),e.jsx(t.Button,{disabled:h,onClick:c,className:"rounded-lg px-3 h-10 flex items-center justify-center bg-gray-200 text-gray-700 hover:bg-gray-300 transition-colors dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600","aria-label":"Refresh",title:"Refresh",children:e.jsx(K,{className:h?"animate-spin":""})})]}),e.jsxs("div",{className:"relative",children:[e.jsxs(t.Button,{onClick:()=>T(!R),className:"rounded-lg px-4 h-10 flex items-center justify-center bg-gray-200 text-gray-700 hover:bg-gray-300 transition-colors dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",children:[e.jsx(Q,{className:"mr-2"}),i==="all"?"All":i==="read"?"Read":"Unread"]}),R&&e.jsx("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg overflow-hidden z-20 dark:bg-gray-800",children:e.jsxs("div",{className:"py-1",children:[e.jsx("button",{onClick:()=>w("all"),className:`w-full text-left px-4 py-2 text-sm ${i==="all"?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":"text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700"}`,children:e.jsxs("div",{className:"flex items-center",children:[i==="all"&&e.jsx(S,{className:"mr-2"}),e.jsx("span",{className:i==="all"?"ml-2":"ml-6",children:"All"})]})}),e.jsx("button",{onClick:()=>w("read"),className:`w-full text-left px-4 py-2 text-sm ${i==="read"?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":"text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700"}`,children:e.jsxs("div",{className:"flex items-center",children:[i==="read"&&e.jsx(S,{className:"mr-2"}),e.jsx("span",{className:i==="read"?"ml-2":"ml-6",children:"Read"})]})}),e.jsx("button",{onClick:()=>w("unread"),className:`w-full text-left px-4 py-2 text-sm ${i==="unread"?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":"text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700"}`,children:e.jsxs("div",{className:"flex items-center",children:[i==="unread"&&e.jsx(S,{className:"mr-2"}),e.jsx("span",{className:i==="unread"?"ml-2":"ml-6",children:"Unread"})]})})]})})]})]}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsx(t.TableContainer,{className:"min-h-[400px]",children:e.jsxs(t.Table,{children:[e.jsx(t.TableHeader,{children:e.jsxs("tr",{children:[e.jsx(t.TableCell,{className:"w-12",children:e.jsx(z,{type:"checkbox",name:"selectAll",id:"selectAll",handleClick:H,isChecked:j})}),e.jsx(t.TableCell,{children:"Notification"}),e.jsx(t.TableCell,{className:"w-32 text-right",children:"Actions"})]})}),e.jsx(t.TableBody,{children:h?e.jsx(t.TableRow,{children:e.jsx(t.TableCell,{colSpan:3,className:"text-center",children:e.jsxs("div",{className:"py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:"Loading notifications..."})]})})}):N.length===0?e.jsx(t.TableRow,{children:e.jsx(t.TableCell,{colSpan:3,className:"text-center",children:e.jsx(ee,{message:"No notifications found",icon:e.jsx(X,{className:"h-12 w-12 text-gray-400"}),className:"py-16"})})}):N.map((s,r)=>e.jsxs(t.TableRow,{className:s.status==="unread"?"bg-blue-50 dark:bg-blue-900/10":"",children:[e.jsx(t.TableCell,{className:"align-top pt-4",children:e.jsx(z,{type:"checkbox",name:s==null?void 0:s._id,id:s._id,handleClick:q,isChecked:n==null?void 0:n.includes(s._id)})}),e.jsx(t.TableCell,{className:"p-0",children:e.jsx(Y,{notification:s,onMarkAsRead:D,onDelete:E,showActions:!1})}),e.jsx(t.TableCell,{className:"text-right align-top pt-4",children:e.jsxs("div",{className:"flex justify-end",children:[s.status==="unread"&&e.jsx(t.Button,{layout:"link",size:"icon","aria-label":"Mark as Read",onClick:()=>D(s._id),className:"text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 mr-1",title:"Mark as Read",children:e.jsx(M,{className:"h-4 w-4"})}),e.jsx(t.Button,{layout:"link",size:"icon","aria-label":"Delete",onClick:()=>E(s._id),className:"text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300",title:"Delete",children:e.jsx(W,{className:"h-4 w-4"})})]})})]},r+1))})]})})}),!h&&m.length>0&&e.jsx("div",{className:"mt-4",children:e.jsx(t.Pagination,{totalResults:$,resultsPerPage:v,onChange:L,label:"Notification Navigation"})})]})})]})};export{ne as default};
