import{k as $,r as j,j as e}from"./index-CjXOYCek.js";import{e as U,f as q,g as z,h as T,i as E,j as v,k as H,l as L,m as J,o as P,p as G,q as M,s as K}from"./Layout-mxREdH8E.js";import{E as S,n as w,a as B}from"./EmployeeServices-gydm101I.js";import{A as Q}from"./AnimatedContent-D_hXsWJF.js";const V=async(C,c,d)=>{var y;try{if(!C)return null;const i=new FormData;i.append("file",C),i.append("upload_preset","ml_default"),c&&i.append("folder",c),d&&i.append("public_id",d);const g=await fetch("https://api.cloudinary.com/v1_1/dn5g7d3q9/image/upload",{method:"POST",body:i});if(!g.ok){const D=await g.json();throw new Error(((y=D.error)==null?void 0:y.message)||"Failed to upload image")}const k=await g.json();return{url:k.secure_url,publicId:k.public_id}}catch(i){throw console.error("Error uploading image to Cloudinary:",i),new Error("Failed to upload image: "+i.message)}},ae=()=>{var F;const{t:C}=$(),[c,d]=j.useState(!1),[y,i]=j.useState(!1),[a,g]=j.useState({image:"",name:"",empCode:"",designation:"",contact:"",email:"",joiningDate:"",dob:"",address:"",emergencyContactName:"",emergencyContactNumber:"",relation:"",bankName:"",branchName:"",ifsc:"",accountNumber:"",reAccountNumber:"",beneficiaryAddress:""});j.useEffect(()=>{(async()=>{var n,r,l,p,u,h,b,x,f,N;try{d(!0);const m=await S.getEmployeeProfile();if(console.log("API Response:",m.employee),m){const t=m.employee;g({image:t.profileImage||"",name:((n=t.name)==null?void 0:n.en)||"",empCode:t.employeeCode||"",designation:t.role||t.designation||"",contact:t.mobile||"",email:t.email||"",joiningDate:t.createdAt||"",dob:t.dateOfBirth||"",address:t.address||"",emergencyContactName:((r=t.emergencyContact)==null?void 0:r.name)||"",emergencyContactNumber:((l=t.emergencyContact)==null?void 0:l.number)||"",relation:((p=t.emergencyContact)==null?void 0:p.relation)||"",bankName:((u=t.bankDetails)==null?void 0:u.bankName)||"",branchName:((h=t.bankDetails)==null?void 0:h.branch)||"",ifsc:((b=t.bankDetails)==null?void 0:b.ifsc)||"",accountNumber:((x=t.bankDetails)==null?void 0:x.accountNumber)||"",reAccountNumber:((f=t.bankDetails)==null?void 0:f.accountNumber)||"",beneficiaryAddress:((N=t.bankDetails)==null?void 0:N.beneficiaryAddress)||""})}}catch(m){w((m==null?void 0:m.message)||"Failed to load profile data")}finally{d(!1)}})()},[]);const k=(o,n)=>{g({...a,[o]:n})},D=o=>o?T(o):"",I=async o=>{const n=o.target.files[0];if(n)try{d(!0);const r=new FileReader;r.onloadend=()=>{g({...a,image:r.result})},r.readAsDataURL(n);const l=await V(n,"profile-images",`employee-${a.empCode||Date.now()}`);l&&l.url&&(g({...a,image:l.url}),B("Profile image uploaded successfully!"))}catch(r){w((r==null?void 0:r.message)||"Failed to upload image"),console.error("Error uploading image:",r)}finally{d(!1)}},R=async()=>{var o,n,r,l,p,u,h,b,x,f,N,m;try{if(d(!0),a.accountNumber!==a.reAccountNumber){w("Account numbers do not match"),d(!1);return}const t={name:{en:a.name},designation:a.designation,mobile:a.contact,email:a.email,dateOfBirth:a.dob,address:a.address,emergencyContact:{name:a.emergencyContactName,number:a.emergencyContactNumber,relation:a.relation},bankDetails:{bankName:a.bankName,branch:a.branchName,ifsc:a.ifsc,accountNumber:a.accountNumber,beneficiaryAddress:a.beneficiaryAddress},...a.image&&a.image.startsWith("http")&&{profileImage:a.image}},s=await S.updateEmployeeProfile(t);B(s.message),i(!1),s.employee&&g({image:s.employee.profileImage||"",name:(o=s.employee.name)==null?void 0:o.en,empCode:s.employee.employeeCode,designation:s.employee.designation,contact:s.employee.mobile,email:s.employee.email,joiningDate:s.employee.createdAt,dob:s.employee.dateOfBirth,address:s.employee.address,emergencyContactName:(n=s.employee.emergencyContact)==null?void 0:n.name,emergencyContactNumber:(r=s.employee.emergencyContact)==null?void 0:r.number,relation:(l=s.employee.emergencyContact)==null?void 0:l.relation,bankName:(p=s.employee.bankDetails)==null?void 0:p.bankName,branchName:(u=s.employee.bankDetails)==null?void 0:u.branch,ifsc:(h=s.employee.bankDetails)==null?void 0:h.ifsc,accountNumber:(b=s.employee.bankDetails)==null?void 0:b.accountNumber,reAccountNumber:(x=s.employee.bankDetails)==null?void 0:x.accountNumber,beneficiaryAddress:(f=s.employee.bankDetails)==null?void 0:f.beneficiaryAddress})}catch(t){w(((m=(N=t==null?void 0:t.response)==null?void 0:N.data)==null?void 0:m.message)||"Failed to update profile")}finally{d(!1)}},_=[{label:"Employee Name",key:"name",icon:e.jsx(E,{}),maxLength:50},{label:"Employee Code",key:"empCode",icon:e.jsx(v,{}),maxLength:10,disabled:!0},{label:"Designation",key:"designation",icon:e.jsx(H,{}),maxLength:50},{label:"Contact Number",key:"contact",icon:e.jsx(L,{}),type:"tel",pattern:"[0-9]{10}",maxLength:10},{label:"Email ID",key:"email",icon:e.jsx(J,{}),type:"email",maxLength:50,disabled:!0},{label:"Joining Date",key:"joiningDate",type:"date",icon:e.jsx(P,{}),formatDisplay:!0,disabled:!0}],O=[{label:"Date of Birth",key:"dob",type:"date",icon:e.jsx(P,{}),formatDisplay:!0},{label:"Address",key:"address",icon:e.jsx(G,{}),maxLength:100},{label:"Emergency Contact Name",key:"emergencyContactName",icon:e.jsx(E,{}),maxLength:50},{label:"Emergency Contact No.",key:"emergencyContactNumber",icon:e.jsx(L,{}),type:"tel",pattern:"[0-9]{10}",maxLength:10},{label:"Relation",key:"relation",icon:e.jsx(E,{}),maxLength:30}],W=[{label:"Bank Name",key:"bankName",icon:e.jsx(M,{}),maxLength:50},{label:"Branch",key:"branchName",icon:e.jsx(M,{}),maxLength:50},{label:"IFSC",key:"ifsc",icon:e.jsx(v,{}),maxLength:11},{label:"Account Number",key:"accountNumber",icon:e.jsx(v,{}),maxLength:18},{label:"Re-Enter Account Number",key:"reAccountNumber",icon:e.jsx(v,{}),maxLength:18},{label:"Beneficiary Address",key:"beneficiaryAddress",icon:e.jsx(K,{}),maxLength:100}],A=o=>o.map(({label:n,key:r,type:l,icon:p,maxLength:u,pattern:h,disabled:b,formatDisplay:x})=>e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"flex items-center gap-1.5 text-sm font-medium mb-1 text-gray-700 dark:text-gray-300",children:[e.jsx("span",{className:"text-base",children:p}),n]}),y?e.jsx("input",{type:l||"text",value:a[r],onChange:f=>k(r,f.target.value),placeholder:n,maxLength:u,pattern:h,disabled:b,className:`w-full px-2.5 py-1.5 text-sm rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-white focus:border-[#1a5d96] dark:focus:border-[#e2692c] focus:ring-1 focus:ring-[#1a5d96] dark:focus:ring-[#e2692c] ${b?"opacity-70 cursor-not-allowed":""}`}):e.jsx("div",{className:"w-full px-2.5 py-1.5 text-sm rounded border border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-white flex items-center truncate overflow-hidden",children:x?D(a[r]):a[r]})]},r));return e.jsx(Q,{children:e.jsx("div",{className:"fixed inset-0 bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-900 dark:to-gray-800 text-gray-800 dark:text-white",children:e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-md p-3 flex justify-between items-center mt-5",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative w-14 h-14 rounded-full overflow-hidden group flex-shrink-0 shadow-md",children:[c&&((F=a.image)!=null&&F.startsWith("data:"))?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100 dark:bg-gray-700",children:e.jsx("div",{className:"w-10 h-10 border-4 border-gray-300 border-t-[#1a5d96] dark:border-t-[#e2692c] rounded-full animate-spin"})}):e.jsx("img",{src:a.image&&(a.image.startsWith("http")||a.image.startsWith("data:"))?a.image:"https://st3.depositphotos.com/6672868/13701/v/450/depositphotos_137014128-stock-illustration-user-profile-icon.jpg",alt:"Profile",className:"w-full h-full object-cover"}),y&&e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"imageUpload",className:`absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center cursor-pointer ${c?"opacity-70":"opacity-0 group-hover:opacity-100"} transition-opacity duration-300`,children:c?e.jsx("span",{className:"text-white text-xs",children:"Uploading..."}):e.jsx(U,{className:"text-white text-base"})}),e.jsx("input",{type:"file",id:"imageUpload",accept:"image/*",onChange:I,className:"hidden",disabled:c})]})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-base font-bold text-[#1a5d96] dark:text-[#e2692c] tracking-tight",children:a.name?a.name:"Name not available"}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:[e.jsx("span",{className:"font-semibold",children:"Employee Code:"})," ",a.empCode?a.empCode:"not available"]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:a.designation?a.designation:"Designation not available"})]})]}),e.jsx("div",{children:e.jsx("button",{onClick:()=>y?R():i(!0),disabled:c,className:`px-3 py-1.5 bg-[#1a5d96] hover:bg-[#154a7a] dark:bg-[#e2692c] dark:hover:bg-[#d15a20] text-white rounded text-sm shadow-md flex items-center gap-1.5 transition-all duration-300 ${c?"opacity-70 cursor-not-allowed":""}`,children:c?e.jsx("span",{children:"Processing..."}):y?e.jsxs(e.Fragment,{children:[e.jsx(q,{size:14})," Save"]}):e.jsxs(e.Fragment,{children:[e.jsx(z,{size:14})," Edit"]})})})]}),e.jsxs("div",{className:"flex-1 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2 p-2 mt-4",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md max-h-[calc(100vh-4.5rem)]",children:[e.jsx("div",{className:"px-3 py-1.5 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800",children:e.jsx("h3",{className:"text-sm font-semibold text-[#1a5d96] dark:text-[#e2692c]",children:"Employee Details"})}),e.jsx("div",{className:"p-3 overflow-y-auto max-h-[calc(100vh-6.5rem)]",children:A(_)})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md max-h-[calc(100vh-4.5rem)]",children:[e.jsx("div",{className:"px-3 py-1.5 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800",children:e.jsx("h3",{className:"text-sm font-semibold text-[#1a5d96] dark:text-[#e2692c]",children:"Personal Details"})}),e.jsx("div",{className:"p-3 overflow-y-auto max-h-[calc(100vh-6.5rem)]",children:A(O)})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md max-h-[calc(100vh-4.5rem)]",children:[e.jsx("div",{className:"px-3 py-1.5 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800",children:e.jsx("h3",{className:"text-sm font-semibold text-[#1a5d96] dark:text-[#e2692c]",children:"Bank Details"})}),e.jsx("div",{className:"p-3 overflow-y-auto max-h-[calc(100vh-6.5rem)]",children:A(W)})]})]})]})})})};export{ae as default};
