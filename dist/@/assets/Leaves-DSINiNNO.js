import{j as e,i as a,r as o,Q as U}from"./index-CjXOYCek.js";import{P as De}from"./PageTitle-DFA0mJ57.js";import{h as c}from"./moment-C5S46NFB.js";import{E as pe}from"./EmployeeServices-gydm101I.js";import{Y as Ce,ac as je,af as Le,ag as oe,ad as ve,ah as Te,ai as _,ab as ie,aj as ye,ak as he,al as xe,am as ce,an as me,ao as be,ap as fe,aq as ge,a7 as Se}from"./Layout-mxREdH8E.js";import{t as I,T as Me,N as Ye}from"./react-datepicker-D1yPfg7-.js";import{u as Fe}from"./index.esm-DMDpr_Fp.js";import{A as Ee}from"./AnimatedContent-D_hXsWJF.js";import{t as Pe,i as Re,j as qe}from"./optionsData-BUE2wvyU.js";import"./index-CmvILeK1.js";const He=({leaves:z})=>{const B=(d,k)=>{const F=c(d),C=c(k);return c.duration(C.diff(F)).asDays()+1},Y=d=>{switch(d.toLowerCase()){case"approved":return"success";case"pending":return"warning";case"rejected":return"danger";case"cancelled":return"neutral";default:return"primary"}};return e.jsx(a.TableBody,{className:"w-full dark:bg-gray-900",children:z.map((d,k)=>e.jsxs(a.TableRow,{children:[e.jsx(a.TableCell,{className:"text-center",children:e.jsx("span",{className:"text-sm font-semibold",children:d.leaveType})}),e.jsx(a.TableCell,{className:"text-center",children:e.jsx("span",{className:"text-sm",children:c(d.startDate).format("MMM DD, YYYY")})}),e.jsx(a.TableCell,{className:"text-center",children:e.jsx("span",{className:"text-sm",children:c(d.endDate).format("MMM DD, YYYY")})}),e.jsx(a.TableCell,{className:"text-center",children:e.jsxs("span",{className:"text-sm",children:[B(d.startDate,d.endDate)," day(s)"]})}),e.jsx(a.TableCell,{className:"text-center",children:e.jsx("span",{className:"text-sm",children:d.leaveReason})}),e.jsx(a.TableCell,{className:"text-center",children:e.jsx(a.Badge,{type:Y(d.status),children:d.status})}),e.jsx(a.TableCell,{className:"text-center",children:e.jsx("span",{className:"text-sm",children:d.approvedBy||"No"})}),e.jsx(a.TableCell,{className:"text-center",children:e.jsx("span",{className:"text-sm",children:Ce(d.createdAt)})})]},d._id||k))})},Ae=({leaves:z=[],loading:B=!1,refresh:Y})=>{const[d,k]=o.useState(null),[F,C]=o.useState(!0),[N,l]=o.useState(null),[f,m]=o.useState(new Date().getMonth()+1),[u,E]=o.useState(new Date().getFullYear()),[D,L]=o.useState(null);o.useEffect(()=>{(async()=>{C(!0);try{const n=await pe.getAttendanceCalendarData(f,u);if(n.success)k(n.data);else throw new Error(n.message||"Failed to fetch calendar data")}catch(n){l(n.message||"An error occurred while fetching calendar data"),console.error("Calendar fetch error:",n)}finally{C(!1)}})()},[f,u,z]),console.log(d);const W=i=>["January","February","March","April","May","June","July","August","September","October","November","December"][i-1],$=()=>{f===1?(m(12),E(u-1)):m(f-1)},G=()=>{f===12?(m(1),E(u+1)):m(f+1)},V=()=>{const i=["S","M","T","W","T","F","S"];return e.jsx("div",{className:"grid grid-cols-7 gap-1 max-w-full overflow-hidden",children:i.map((n,j)=>e.jsx("div",{className:`text-center text-xs sm:text-sm font-semibold py-1 sm:py-2 ${j===0?"text-rose-500 dark:text-rose-400":j===6?"text-blue-500 dark:text-blue-400":"text-gray-600 dark:text-gray-400"}`,children:n},`day-header-${j}`))})},K=()=>{var X,w;if(!d)return null;const{year:i,month:n,calendar:j}=d,v=d.totalDays,se=new Date(i,n-1,1).getDay(),J=[];for(let g=0;g<se;g++)J.push(e.jsx("div",{className:"h-8 sm:h-11 md:h-14 rounded-md"},`empty-${g}`));for(let g=1;g<=v;g++){const s=j[g]||{status:"Present",type:"P"},q=new Date().getDate()===g&&new Date().getMonth()===n-1&&new Date().getFullYear()===i,h=D===g,p=s.status.toLowerCase().includes("pending")||s.leaveDetails&&s.leaveDetails.status==="Pending",H=s.status.toLowerCase().includes("rejected")||s.leaveDetails&&s.leaveDetails.status==="Rejected",T=new Date(i,n-1,g).getDay(),re=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][T];let y=null,A=null;p&&s.type!=="P"&&s.type!=="WO"&&s.type!=="NR"?y=e.jsx(oe,{className:"text-orange-500 dark:text-orange-400 animate-spin-slow text-[8px] md:text-[12px] lg:text-[14px]"}):s.type==="P"||(X=s==null?void 0:s.attendanceDetails)!=null&&X.present?y=e.jsx(ie,{className:"text-green-500 dark:text-green-400 text-[8px] md:text-[12px] lg:text-[14px]"}):s.type==="NR"?y=e.jsx(ye,{className:"bg-blue-50 dark:bg-blue-900/20 text-blue-500 dark:text-blue-400"}):s.type.includes("WO")?(y=e.jsx(_,{className:"text-green-500 dark:text-green-400 text-[8px] md:text-[12px] lg:text-[14px]"}),A="bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800"):s.type.includes("SL")?y=e.jsx(xe,{className:"text-red-500 dark:text-red-400 text-[8px] md:text-[12px] lg:text-[14px]"}):s.type.includes("CL")?y=e.jsx(ce,{className:"text-amber-500 dark:text-amber-400 text-[8px] md:text-[12px] lg:text-[14px]"}):s.type.includes("PL")?y=e.jsx(me,{className:"text-blue-500 dark:text-blue-400 text-[8px] md:text-[12px] lg:text-[14px]"}):s.type.includes("SDL")&&(y=e.jsx(ge,{className:"text-orange-500 dark:text-orange-400 text-[8px] md:text-[12px] lg:text-[14px]"})),H&&s.type!=="P"&&s.type!=="WO"&&s.type!=="U"&&(y=e.jsx(he,{className:"text-red-500 dark:text-red-400 text-[8px] md:text-[12px] lg:text-[14px]"}));let x=[];if(s.type&&s.type.includes("-HD")&&x.push(e.jsx(be,{size:10,className:"text-indigo-500 dark:text-indigo-400 absolute top-0.5 right-0.5 sm:top-1 sm:right-1 text-[8px] md:text-[12px] lg:text-[14px]"})),s.type&&s.type.includes("-EL")&&x.push(e.jsx(fe,{size:10,className:"text-gray-500 dark:text-gray-400 absolute top-0.5 right-0.5 sm:top-1 sm:right-1 text-[8px] md:text-[12px] lg:text-[14px]"})),T===0&&s.type&&!s.type.includes("WO")&&s.leaveReason&&(x.push(e.jsx(_,{size:10,className:"text-green-500 dark:text-green-400 absolute top-0.5 right-0.5 sm:top-1 sm:right-1 text-[8px] md:text-[12px] lg:text-[14px]"})),A="bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800"),T===6){const le=7-((new Date(i,n-1,1).getDay()+1)%7||7)+1,Z=Math.floor((g-le)/7)+1;(Z===2||Z===4)&&(s.type.includes("WO")||(s.leaveReason?x.push(e.jsx(_,{size:10,className:"text-green-500 dark:text-green-400 absolute top-0.5 right-0.5 sm:top-1 sm:right-1 text-[8px] md:text-[12px] lg:text-[14px]"})):(y===null||s.type==="P")&&(y=e.jsx(_,{size:10,className:"text-green-500 dark:text-green-400 absolute top-0.5 right-0.5 sm:top-1 sm:right-1 text-[8px] md:text-[12px] lg:text-[14px]"})),A="bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800"))}s.approved===!1&&s.type.includes("PL")&&x.push(e.jsx(me,{size:10,className:"text-blue-500 dark:text-blue-400 absolute bottom-0.5 right-0.5 sm:bottom-1 sm:right-1 text-[8px] md:text-[12px] lg:text-[14px]"})),s.approved===!1&&s.type.includes("CL")&&x.push(e.jsx(ce,{size:10,className:"text-red-500 dark:text-red-400 absolute bottom-0.5 right-0.5 sm:bottom-1 sm:right-1 text-[8px] md:text-[12px] lg:text-[14px]"})),s.approved===!1&&s.type.includes("SDL")&&x.push(e.jsx(ge,{size:10,className:"text-orange-500 dark:text-orange-400 absolute bottom-0.5 right-0.5 sm:bottom-0.5 sm:right-1 text-[8px] md:text-[12px] lg:text-[14px]"})),s.approved===!1&&s.type.includes("SL")&&x.push(e.jsx(xe,{size:10,className:"text-red-500 dark:text-red-400 absolute bottom-0.5 right-0.5 sm:bottom-1 sm:right-1 text-[8px] md:text-[12px] lg:text-[14px]"})),s.approved===!1&&((w=s==null?void 0:s.attendanceDetails)!=null&&w.present)&&x.push(e.jsx(ie,{className:"text-green-500 dark:text-green-400 absolute bottom-0.5 left-1 sm:bottom-1 sm:right-1 text-[8px] md:text-[12px] lg:text-[14px]"})),p&&x.push(e.jsx("span",{className:"absolute top-0 left-0 w-0 h-0 border-solid border-t-[6px] md:border-t-[8px] border-t-orange-500 dark:border-t-orange-400 border-r-[6px] md:border-r-[8px] border-r-transparent"},"pending")),H&&x.push(e.jsx("span",{className:"absolute top-0 left-0 w-0 h-0 border-solid border-t-[6px] md:border-t-[8px] border-t-red-500 dark:border-t-red-400 border-r-[6px] md:border-r-[8px] border-r-transparent"},"rejected"));let S=`relative h-8 sm:h-11 md:h-14 rounded-md border ${s.type.includes("P")?null:A} flex flex-col items-center justify-center cursor-pointer`;q&&(S+=" ring-1 sm:ring-2 ring-blue-500 dark:ring-blue-400 ring-offset-1 sm:ring-offset-2 dark:ring-offset-gray-900 ring-opacity-70"),h?S+=" transform scale-95 shadow-inner dark:shadow-gray-900":S+=" border-1 sm:border-2 border-gray-200 dark:border-gray-700 hover:shadow-md dark:hover:shadow-gray-900 hover:-translate-y-1",p&&(S+=" bg-orange-50 dark:bg-orange-900/20 border-orange-200 dark:border-orange-800"),J.push(e.jsxs("div",{className:S,onClick:()=>L(h?null:g),children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[6px] sm:text-[8px] md:text-[10px] text-gray-500 dark:text-gray-400",children:re}),e.jsx("span",{className:`font-semibold text-2xs xs:text-xs ${q?"text-blue-600 dark:text-blue-400":"text-gray-800 dark:text-gray-200"}`,children:g})]}),e.jsx("div",{className:"flex items-center justify-center my-0.5 sm:my-1 text-center text-[6px] md:text-[12px] lg:text-[14px]",children:y}),x]},`day-${g}`))}return e.jsx("div",{className:"grid grid-cols-7 gap-0.5 xs:gap-1 sm:gap-1 max-w-full overflow-hidden",children:J})},P=()=>{const i=[{icon:e.jsx(ie,{className:"text-[8px] md:text-[12px] lg:text-[14px]"}),color:"bg-green-50 dark:bg-green-900/20 text-green-500 dark:text-green-400",text:"Present"},{icon:e.jsx(_,{className:"text-[8px] md:text-[12px] lg:text-[14px]"}),color:"bg-gray-50 dark:bg-gray-800 text-gray-500 dark:text-gray-400",text:"Week Off"},{icon:e.jsx(ye,{className:"text-[8px] md:text-[12px] lg:text-[14px]"}),color:"bg-blue-50 dark:bg-blue-900/20 text-blue-500 dark:text-blue-400",text:"No Record"},{icon:e.jsx(oe,{className:"text-[8px] md:text-[12px] lg:text-[14px] animate-spin-slow"}),color:"bg-orange-50 dark:bg-orange-900/20 text-orange-500 dark:text-orange-400",text:"Pending"},{icon:e.jsx(he,{className:"text-[8px] md:text-[12px] lg:text-[14px]"}),color:"bg-red-50 dark:bg-red-900/20 text-red-500 dark:text-red-400",text:"Rejected"},{icon:e.jsx(xe,{className:"text-[8px] md:text-[12px] lg:text-[14px]"}),color:"bg-red-50 dark:bg-red-900/20 text-red-500 dark:text-red-400",text:"Sick"},{icon:e.jsx(ce,{className:"text-[8px] md:text-[12px] lg:text-[14px]"}),color:"bg-amber-50 dark:bg-amber-900/20 text-amber-500 dark:text-amber-400",text:"Casual"},{icon:e.jsx(me,{className:"text-[8px] md:text-[12px] lg:text-[14px]"}),color:"bg-blue-50 dark:bg-blue-900/20 text-blue-500 dark:text-blue-400",text:"Privilege"},{icon:e.jsx(be,{className:"text-[8px] md:text-[12px] lg:text-[14px]"}),color:"bg-indigo-50 dark:bg-indigo-900/20 text-indigo-500 dark:text-indigo-400",text:"Half Day"},{icon:e.jsx(fe,{className:"text-[8px] md:text-[12px] lg:text-[14px]"}),color:"bg-gray-50 dark:bg-gray-800 text-gray-500 dark:text-gray-400",text:"Early Out"},{icon:e.jsx(ge,{className:"text-[8px] md:text-[12px] lg:text-[14px]"}),color:"bg-amber-100 dark:bg-amber-900/30 text-orange-500 dark:text-orange-400",text:"Sandwich"}];return e.jsx("div",{className:"flex flex-wrap justify-center gap-1 xs:gap-2 mt-2 sm:mt-4 px-1",children:i.map((n,j)=>e.jsxs("div",{className:"legend-pill flex items-center px-1 xs:px-1 py-0.5 xs:py-0.5 rounded-full border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 text-2xs xs:text-xs shadow-sm dark:shadow-gray-900 mb-1",children:[e.jsx("span",{className:`flex items-center justify-center w-4 h-4 xs:w-5 xs:h-5 rounded-full mr-0.5 xs:mr-1 ${n.color}`,children:n.icon}),e.jsx("span",{className:"text-gray-800 dark:text-gray-200 text-[8px] md:text-[12px] lg:text-[14px]",children:n.text})]},j))})},ae=()=>{if(!D||!(d!=null&&d.calendar[D]))return null;const i=d.calendar[D],n=new Date(u,f-1,D).getDay(),v=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][n];return e.jsxs("div",{className:"mt-2 sm:mt-4 p-2 sm:p-3 rounded-md bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 dark:shadow-gray-900 animate-fadeIn",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1 sm:mb-2",children:[e.jsxs("h3",{className:"text-sm sm:text-base font-medium text-gray-800 dark:text-gray-200",children:[v,", ",W(f)," ",D,", ",u]}),e.jsx("button",{onClick:()=>L(null),className:"text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex flex-col text-xs sm:text-sm",children:[e.jsxs("div",{className:"flex items-center py-0.5 sm:py-1",children:[e.jsx("span",{className:"font-semibold text-gray-700 dark:text-gray-300 w-16 sm:w-24",children:"Status:"}),e.jsx("span",{className:"text-gray-800 dark:text-gray-200",children:i.status||"Present"})]}),i.leaveType&&e.jsxs("div",{className:"flex items-center py-0.5 sm:py-1",children:[e.jsx("span",{className:"font-semibold text-gray-700 dark:text-gray-300 w-16 sm:w-24",children:"Type:"}),e.jsx("span",{className:"text-gray-800 dark:text-gray-200",children:i.leaveType})]}),i.leaveReason&&e.jsxs("div",{className:"flex items-center py-0.5 sm:py-1",children:[e.jsx("span",{className:"font-semibold text-gray-700 dark:text-gray-300 w-16 sm:w-24",children:"Reason:"}),e.jsx("span",{className:"text-gray-800 dark:text-gray-200",children:i.leaveReason})]}),i.description&&e.jsxs("div",{className:"flex flex-col sm:flex-row items-start py-0.5 sm:py-1",children:[e.jsx("span",{className:"font-semibold text-gray-700 dark:text-gray-300 w-16 sm:w-24 mb-0.5 sm:mb-0",children:"Description:"}),e.jsx("span",{className:"text-gray-800 dark:text-gray-200 break-words",children:i.description})]})]})]})},R=()=>{Y&&typeof Y=="function"?Y():(m(new Date().getMonth()),E(new Date().getFullYear()),L(null),fetchCalendarData())};return e.jsxs("div",{className:"relative bg-gradient-to-br from-white to-gray-50 dark:from-gray-900 dark:to-gray-800 rounded-lg sm:rounded-xl shadow-md dark:shadow-gray-900 overflow-hidden",children:[P(),e.jsx("div",{className:"p-2 sm:p-4 bg-white dark:bg-gray-800 border-b border-gray-100 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{className:"p-1 sm:p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700",onClick:$,children:e.jsx(je,{className:"text-gray-600 dark:text-gray-400 text-xs sm:text-base"})}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(Le,{className:"text-blue-500 dark:text-blue-400 mr-1 sm:mr-2 text-xs sm:text-base"}),e.jsxs("h2",{className:"text-sm sm:text-xl font-semibold text-gray-800 dark:text-gray-200",children:[W(f)," ",u]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{className:"p-1 sm:p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 mr-1",onClick:R,title:"Refresh calendar",children:e.jsx(oe,{className:"text-gray-600 dark:text-gray-400 text-xs sm:text-base"})}),e.jsx("button",{className:"p-1 sm:p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700",onClick:G,children:e.jsx(ve,{className:"text-gray-600 dark:text-gray-400 text-xs sm:text-base"})})]})]})}),e.jsx("div",{className:"p-2 sm:p-3",children:F||B?e.jsxs("div",{className:"flex items-center justify-center py-8 sm:py-16",children:[e.jsx("div",{className:"loader"}),e.jsx("span",{className:"ml-3 text-xs sm:text-sm text-gray-500 dark:text-gray-400",children:"Loading..."})]}):N?e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 sm:py-16 text-center",children:[e.jsx("div",{className:"w-12 h-12 sm:w-16 sm:h-16 bg-red-100 dark:bg-red-900/20 rounded-full flex items-center justify-center mb-3 sm:mb-4",children:e.jsx(Te,{className:"text-red-500 dark:text-red-400",size:20})}),e.jsx("p",{className:"text-xs sm:text-sm text-red-600 dark:text-red-400 mb-3 sm:mb-4",children:N}),e.jsx("button",{onClick:R,className:"px-3 py-1 sm:px-4 sm:py-2 bg-blue-500 dark:bg-blue-600 text-white text-xs sm:text-sm rounded-md hover:bg-blue-600 dark:hover:bg-blue-500",children:"Retry"})]}):e.jsxs(e.Fragment,{children:[V(),K(),ae(),"          "]})}),e.jsx("style",{jsx:!0,children:`
        .loader {
          border: 2px solid #f3f3f3;
          border-top: 2px solid #3498db;
          border-radius: 50%;
          width: 20px;
          height: 20px;
          animation: spin 1s linear infinite;
        }

        @media (min-width: 640px) {
          .loader {
            border-width: 3px;
            width: 24px;
            height: 24px;
          }
        }
        
        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
        
        @keyframes spin-slow {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
        
        @keyframes fadeIn {
          from { opacity: 0; transform: translateY(-5px); }
          to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-spin-slow {
          animation: spin-slow 3s linear infinite;
        }
        
        .animate-fadeIn {
          animation: fadeIn 0.2s ease-out forwards;
        }
        
        
        
        .legend-pill:hover {
          transform: translateY(-2px);
          box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .tooltip {
          animation: fadeIn 0.2s ease-out forwards;
        }

        /* Custom text size for very small screens */
        .text-2xs {
          font-size: 0.65rem;
          line-height: 0.9rem;
        }

        /* Custom screen size */
        @media (min-width: 480px) {
          .xs:text-xs {
            font-size: 0.75rem;
            line-height: 1rem;
          }
          .xs:gap-2 {
            gap: 0.5rem;
          }
          .xs:px-2 {
            padding-left: 0.5rem;
            padding-right: 0.5rem;
          }
          .xs:py-1 {
            padding-top: 0.25rem;
            padding-bottom: 0.25rem;
          }
          .xs:mr-1 {
            margin-right: 0.25rem;
          }
          .xs:w-5 {
            width: 1.25rem;
          }
          .xs:h-5 {
            height: 1.25rem;
          }
          .xs:gap-1 {
            gap: 0.25rem;
          }
        }

        /* Dark mode style for loader */
        @media (prefers-color-scheme: dark) {
          .loader {
            border-color: #374151;
            border-top-color: #60a5fa;
          }
        }
      `})]})},Ke=()=>{const[z,B]=o.useState([]),[Y,d]=o.useState([]),[k,F]=o.useState(!0),[C,N]=o.useState(!1),[l,f]=o.useState({startDate:null,endDate:null}),[m,u]=o.useState(1),[E,D]=o.useState(),[L,W]=o.useState(!1),[$,G]=o.useState({status:""}),[V,K]=o.useState("day"),[P,ae]=o.useState(10),[R,i]=o.useState(null),[n,j]=o.useState(null),[v,se]=o.useState(""),[J,X]=o.useState(!0),{register:w,handleSubmit:g,reset:s,watch:q,setValue:h,formState:{errors:p}}=Fe(),H=q("leaveType"),T=q("startDate"),Q=q("singleDate");o.useEffect(()=>{if(se(H),H==="Early Logout"){const t=new Date().getHours();X(t>=17);const r=c().format("YYYY-MM-DD");h("singleDate",r),h("startDate",r),h("endDate",r),h("leaveReason","Early Logout"),h("description","Request for early logout today"),j(!0)}},[H,h]),o.useEffect(()=>{R&&T&&h("endDate",T),n&&Q&&(h("startDate",Q),h("endDate",Q))},[R,T,n,Q,h]);const re=t=>{const{name:r,value:b}=t.target;G({...$,[r]:b}),u(1)},y=t=>{K(t)},A=t=>{const r=parseInt(t.target.value);ae(r),u(1)},x=(t,r)=>{f({startDate:t,endDate:r}),u(1)},S=()=>{m<O&&u(m+1)},ue=()=>{m>1&&u(m-1)},le=()=>{G({status:""}),f({startDate:null,endDate:null}),K("day"),u(1)},Z=t=>{if(!l.startDate||!l.endDate)return t;const r=c(l.startDate).startOf("day"),b=c(l.endDate).endOf("day");return t.filter(te=>c(te.startDate).isBetween(r,b,"day","[]"))},we=t=>{const{status:r}=$;return r?(console.log("Filtering by status:",r),console.log("Leave statuses:",t.map(b=>b.status)),t.filter(b=>b.status.toLowerCase()===r.toLowerCase())):t},M=(t=>{let r=Z(t);return r=we(r),r})(z),O=Math.ceil(M.length/P),ne=async()=>{try{F(!0);const t=await pe.getEmployeeLeaves();console.log(t),t.success&&(B(t.data),d(t.data),u(1))}catch(t){D(t.message||"Failed to fetch leaves"),console.error("Error fetching leaves:",t)}finally{F(!1)}},ke=async t=>{try{N(!0);let r,b;if(t.leaveType==="Early Logout"){if(new Date().getHours()<17){U.error("Early logout can only be requested after 5 PM"),N(!1);return}r=c(),b=c()}else n?(r=c(t.singleDate),b=c(t.singleDate)):(r=c(t.startDate),b=c(t.endDate));if(b.isBefore(r)){U.error("End date cannot be before start date"),N(!1);return}const te={...t,startDate:r.format("YYYY-MM-DD"),endDate:b.format("YYYY-MM-DD")};(n||t.leaveType==="Early Logout")&&delete te.singleDate;const de=await pe.applyForLeave(te);de.success?(U.success("Leave applied successfully"),s(),W(!1),ne()):U.error(de.message||"Failed to apply for leave")}catch(r){U.error(r.message||"An error occurred"),console.error("Error applying for leave:",r)}finally{N(!1)}};o.useEffect(()=>{ne()},[]);const Ne=()=>{const t=(m-1)*P,r=t+P;return M.slice(t,r)},ee=()=>{W(!L),L||s()};return e.jsxs(e.Fragment,{children:[e.jsx(De,{children:"Leave Management"}),e.jsxs("div",{className:"grid gap-6 mb-8 w-full",children:[e.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6",children:e.jsx("div",{className:"flex space-x-3 mt-3 sm:mt-0",children:e.jsx(a.Button,{onClick:ee,className:"rounded-lg hover:shadow-md bg-purple-600 hover:bg-purple-700 dark:bg-purple-700 dark:hover:bg-purple-800",children:e.jsxs("span",{className:"flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Apply for Leave"]})})})}),e.jsx("div",{className:"relative pb-4",children:e.jsx(Ee,{children:e.jsx("div",{className:"rounded-lg shadow-md bg-white dark:bg-gray-700 p-3 max-w-full mb-4",children:e.jsxs("div",{className:"flex flex-wrap items-end gap-3 pb-2",children:[e.jsx("div",{className:"flex-none",children:e.jsxs("button",{onClick:le,className:"px-3 py-1.5 rounded-md text-xs bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 text-gray-700 dark:text-gray-300",children:[e.jsx(Se,{className:"mr-1 inline"}),"Reset"]})}),e.jsx("div",{className:"w-full sm:w-auto sm:flex-none sm:min-w-[150px]",children:e.jsx("select",{name:"status",value:$.status,onChange:t=>re(t),className:"w-full px-2.5 py-1.5 text-xs rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-1",children:Pe.map((t,r)=>e.jsx("option",{value:t.value,children:t.label},r))})}),e.jsx("div",{className:"w-full sm:w-auto sm:flex-none sm:min-w-[120px]",children:e.jsx("select",{value:V,onChange:t=>y(t.target.value),className:"w-full px-2.5 py-1.5 text-xs rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-1",children:Re.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})}),V==="year"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full sm:w-auto sm:flex-none sm:min-w-[120px]",children:e.jsx(I,{selected:l.startDate,onChange:t=>x(t,l.endDate),selectsStart:!0,startDate:l.startDate,endDate:l.endDate,dateFormat:"yyyy",showYearPicker:!0,className:"w-full px-2.5 py-1.5 text-xs rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-1",placeholderText:"Start Year",popperClassName:"z-50"})}),e.jsx("div",{className:"w-full sm:w-auto sm:flex-none sm:min-w-[120px]",children:e.jsx(I,{selected:l.endDate,onChange:t=>x(l.startDate,t),selectsEnd:!0,startDate:l.startDate,endDate:l.endDate,dateFormat:"yyyy",showYearPicker:!0,className:"w-full px-2.5 py-1.5 text-xs rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-1",placeholderText:"End Year",popperClassName:"z-50"})})]}):V==="month"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full sm:w-auto sm:flex-none sm:min-w-[130px]",children:e.jsx(I,{selected:l.startDate,onChange:t=>x(t,l.endDate),selectsStart:!0,startDate:l.startDate,endDate:l.endDate,dateFormat:"MMM-yyyy",showMonthYearPicker:!0,className:"w-full px-2.5 py-1.5 text-xs rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-1",placeholderText:"Start Month",popperClassName:"z-50"})}),e.jsx("div",{className:"w-full sm:w-auto sm:flex-none sm:min-w-[130px]",children:e.jsx(I,{selected:l.endDate,onChange:t=>x(l.startDate,t),selectsEnd:!0,startDate:l.startDate,endDate:l.endDate,dateFormat:"MMM-yyyy",showMonthYearPicker:!0,className:"w-full px-2.5 py-1.5 text-xs rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-1",placeholderText:"End Month",popperClassName:"z-50"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full sm:w-auto sm:flex-none sm:min-w-[130px]",children:e.jsx(I,{selected:l.startDate,onChange:t=>x(t,l.endDate),selectsStart:!0,startDate:l.startDate,endDate:l.endDate,dateFormat:"dd-MMM-yyyy",className:"w-full px-2.5 py-1.5 text-xs rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-1",placeholderText:"Start Date",popperClassName:"z-50"})}),e.jsx("div",{className:"w-full sm:w-auto sm:flex-none sm:min-w-[130px]",children:e.jsx(I,{selected:l.endDate,onChange:t=>x(l.startDate,t),selectsEnd:!0,startDate:l.startDate,endDate:l.endDate,dateFormat:"dd-MMM-yyyy",className:"w-full px-2.5 py-1.5 text-xs rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-1",placeholderText:"End Date",popperClassName:"z-50"})})]}),e.jsx("div",{className:"w-full sm:w-auto sm:flex-none sm:min-w-[100px]",children:e.jsx("select",{value:P,onChange:t=>A(t),className:"w-full px-2.5 py-1.5 text-xs rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-1",children:qe.map(t=>e.jsxs("option",{value:t.value,children:[t.label," per page"]},t.value))})}),M.length>0&&e.jsx("div",{className:"w-full sm:w-auto sm:flex-none sm:ml-auto",children:e.jsxs("div",{className:"flex items-center justify-center sm:justify-end space-x-1",children:[e.jsx("button",{onClick:ue,disabled:m===1,className:`flex items-center justify-center p-1.5 h-8 w-8 rounded-md ${m===1?"bg-gray-200 dark:bg-gray-600 text-gray-400 dark:text-gray-500 cursor-not-allowed":"bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 text-gray-700 dark:text-gray-200"}`,children:e.jsx(je,{className:"h-3 w-3"})}),e.jsxs("span",{className:"text-xs text-gray-700 dark:text-gray-300",children:[m," / ",O||1]}),e.jsx("button",{onClick:S,disabled:m===O||O===0,className:`flex items-center justify-center p-1.5 h-8 w-8 rounded-md ${m===O||O===0?"bg-gray-200 dark:bg-gray-600 text-gray-400 dark:text-gray-500 cursor-not-allowed":"bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 text-gray-700 dark:text-gray-200"}`,children:e.jsx(ve,{className:"h-3 w-3"})})]})})]})})})}),e.jsxs(a.Modal,{isOpen:L,onClose:ee,children:[e.jsx(a.ModalHeader,{className:"flex justify-between items-center",children:e.jsx("span",{children:"Apply for Leave"})}),e.jsx(a.ModalBody,{children:e.jsxs("form",{id:"leaveApplicationForm",onSubmit:g(ke),children:[e.jsx("div",{className:"mb-6",children:e.jsxs(a.Label,{className:"font-medium",children:[e.jsx("span",{children:"Leave Type"}),e.jsxs(a.Select,{className:"mt-1 w-full dark:bg-gray-800 dark:border-gray-600 bg-white border-gray-300",...w("leaveType",{required:"Leave type is required"}),children:[e.jsx("option",{value:"",children:"Select leave type"}),e.jsx("option",{value:"Half Day",children:"Half Day"}),e.jsx("option",{value:"Full Day",children:"Full Day"}),e.jsx("option",{value:"Early Logout",children:"Early Logout"})]}),p.leaveType&&e.jsx(a.HelperText,{valid:!1,children:p.leaveType.message||"Leave type is required"}),v==="Early Logout"&&!J&&e.jsx(a.HelperText,{valid:!1,children:"Early logout can only be requested after 5 PM"})]})}),v!=="Early Logout"&&e.jsx("div",{className:"mb-6",children:e.jsxs(a.Label,{className:"font-medium",children:[e.jsx("span",{children:"Reason Category"}),e.jsxs(a.Select,{className:"mt-1 w-full dark:bg-gray-800 dark:border-gray-600 bg-white border-gray-300",...w("leaveReason",{required:"Reason category is required"}),children:[e.jsx("option",{value:"",children:"Select reason"}),e.jsx("option",{value:"Casual Leave",children:"Casual Leave"}),e.jsx("option",{value:"Sick Leave",children:"Sick Leave"}),e.jsx("option",{value:"Privilege Leave",children:"Privilege Leave"})]}),p.leaveReason&&e.jsx(a.HelperText,{valid:!1,children:p.leaveReason.message||"Reason is required"})]})}),v!=="Early Logout"&&e.jsx("div",{className:"mb-6",children:e.jsxs(a.Label,{className:"font-medium",children:[e.jsx("span",{children:"Is this a single day leave?"}),e.jsxs("div",{className:"mt-2 flex space-x-4",children:[e.jsxs(a.Label,{className:"inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",name:"singleDayQuestion",value:"yes",checked:n===!0,onChange:()=>j(!0),className:"form-radio h-4 w-4 text-purple-600 dark:bg-gray-800 dark:border-gray-600 border-gray-300 rounded-full focus:ring-purple-500"}),e.jsx("span",{className:"ml-2",children:"Yes"})]}),e.jsxs(a.Label,{className:"inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",name:"singleDayQuestion",value:"no",checked:n===!1,onChange:()=>j(!1),className:"form-radio h-4 w-4 text-purple-600 dark:bg-gray-800 dark:border-gray-600 border-gray-300 rounded-full focus:ring-purple-500"}),e.jsx("span",{className:"ml-2",children:"No"})]})]})]})}),v==="Early Logout"?e.jsx("div",{className:"mb-6",children:e.jsxs(a.Label,{className:"font-medium",children:[e.jsx("span",{children:"Today's Date (Auto-selected)"}),e.jsx(a.Input,{type:"date",className:"mt-1 w-full dark:bg-gray-800 dark:border-gray-600 bg-white border-gray-300",value:c().format("YYYY-MM-DD"),disabled:!0}),e.jsx(a.HelperText,{children:"Early logout is only applicable for today's date"})]})}):n===!0&&e.jsx("div",{className:"mb-6",children:e.jsxs(a.Label,{className:"font-medium",children:[e.jsx("span",{children:"Date"}),e.jsx("div",{className:"relative",children:e.jsx(a.Input,{type:"date",className:"mt-1 w-full dark:bg-gray-800 dark:border-gray-600 bg-white border-gray-300",min:c().format("YYYY-MM-DD"),...w("singleDate",{required:"Date is required"})})}),p.singleDate&&e.jsx(a.HelperText,{valid:!1,children:p.singleDate.message||"Date is required"})]})}),v!=="Early Logout"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2 mb-6",children:[e.jsx("div",{children:e.jsxs(a.Label,{className:"font-medium",children:[e.jsx("span",{children:"Start Date"}),e.jsx("div",{className:"relative",children:e.jsx(a.Input,{type:"date",className:"mt-1 w-full dark:bg-gray-800 dark:border-gray-600 bg-white border-gray-300",min:c().format("YYYY-MM-DD"),...w("startDate",{required:!n&&"Start date is required"})})}),p.startDate&&e.jsx(a.HelperText,{valid:!1,children:p.startDate.message||"Start date is required"})]})}),e.jsx("div",{children:e.jsxs(a.Label,{className:"font-medium",children:[e.jsx("span",{children:"End Date"}),e.jsx("div",{className:"relative",children:e.jsx(a.Input,{type:"date",className:"mt-1 w-full dark:bg-gray-800 dark:border-gray-600 bg-white border-gray-300",min:c().format("YYYY-MM-DD"),disabled:R,...w("endDate",{required:!n&&"End date is required"})})}),p.endDate&&e.jsx(a.HelperText,{valid:!1,children:p.endDate.message||"End date is required"})]})})]})}),e.jsx("div",{className:"mb-4",children:e.jsxs(a.Label,{className:"font-medium",children:[e.jsx("span",{children:"Description"}),e.jsx(a.Textarea,{className:"mt-1 w-full dark:bg-gray-800 dark:border-gray-600 bg-white border-gray-300",rows:"4",placeholder:"Please provide detailed information about your leave request",disabled:v==="Early Logout",...w("description",{required:"Description is required",minLength:{value:10,message:"Description should be at least 10 characters"}})}),p.description&&v!=="Early Logout"&&e.jsx(a.HelperText,{valid:!1,children:p.description.message||"Description is required"}),v==="Early Logout"&&e.jsx(a.HelperText,{children:"Description is auto-populated for early logout requests"})]})})]})}),e.jsx(a.ModalFooter,{children:e.jsxs("div",{className:"flex justify-end gap-4 w-full",children:[e.jsx(a.Button,{layout:"outline",onClick:ee,className:"flex-1 rounded-lg hover:shadow-md dark:text-gray-200 dark:border-gray-600 dark:hover:bg-gray-700",children:"Cancel"}),e.jsx(a.Button,{type:"submit",form:"leaveApplicationForm",disabled:C,className:"flex-1 rounded-lg hover:shadow-md bg-purple-600 hover:bg-purple-700 dark:bg-purple-700 dark:hover:bg-purple-800",children:C?"Submitting...":"Submit Request"})]})})]}),k?e.jsx(Me,{row:8,col:7,width:190,height:20}):E?e.jsx("div",{className:"text-center p-6 w-full bg-gray-50 dark:bg-gray-800 rounded-lg",children:e.jsx("span",{className:"text-red-500 dark:text-red-400",children:E})}):M.length>0?e.jsxs(a.TableContainer,{className:"mb-4 w-full rounded-lg overflow-hidden",children:[e.jsx("div",{className:"p-4 flex flex-col bg-gray-50 dark:bg-gray-900 sm:flex-row justify-between items-start sm:items-center",children:e.jsxs(a.Badge,{type:"primary",className:"mb-2 sm:mb-0 text-sm px-3 py-1 rounded-full",children:[M.length," ",M.length===1?"Leave":"Leaves"," found"]})}),e.jsxs(a.Table,{className:"w-full",children:[e.jsx(a.TableHeader,{children:e.jsxs("tr",{className:"h-14 text-xs font-semibold text-left bg-gray-50 dark:bg-gray-800 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",children:[e.jsx(a.TableCell,{className:"text-center whitespace-nowrap px-4 py-3",children:"Leave Type"}),e.jsx(a.TableCell,{className:"text-center whitespace-nowrap px-4 py-3",children:"Start Date"}),e.jsx(a.TableCell,{className:"text-center whitespace-nowrap px-4 py-3",children:"End Date"}),e.jsx(a.TableCell,{className:"text-center whitespace-nowrap px-4 py-3",children:"Duration"}),e.jsx(a.TableCell,{className:"text-center whitespace-nowrap px-4 py-3",children:"Reason"}),e.jsx(a.TableCell,{className:"text-center whitespace-nowrap px-4 py-3",children:"Status"}),e.jsx(a.TableCell,{className:"text-center whitespace-nowrap px-4 py-3",children:"Approved By"}),e.jsx(a.TableCell,{className:"text-center whitespace-nowrap px-4 py-3",children:"Applied On"})]})}),e.jsx(He,{leaves:Ne()})]})]}):e.jsx("div",{className:"text-center p-8 w-full bg-gray-50 dark:bg-gray-800 rounded-lg shadow-md",children:e.jsx(Ye,{title:"No leaves found",subtitle:"You haven't applied for any leaves yet.",ctaText:"Apply for Leave",ctaAction:ee})}),e.jsx("section",{className:"mb-8",children:e.jsx(Ae,{leaves:M,loading:k,refresh:ne})})]})]})};export{Ke as default};
