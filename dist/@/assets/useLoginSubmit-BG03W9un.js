import{r as o,A as H,a as K,u as M,g as q}from"./index-CjXOYCek.js";import{u as Q}from"./index.esm-DMDpr_Fp.js";import{n as r,E as i,a as n}from"./EmployeeServices-gydm101I.js";const te=()=>{const[L,s]=o.useState(!1),[p,f]=o.useState(!1),[l,d]=o.useState(null),[N,m]=o.useState(""),{dispatch:g}=o.useContext(H),y=K(),u=M(),{register:I,handleSubmit:T,formState:{errors:x},setValue:S}=Q();return{onSubmit:async({name:E,email:t,password:a,confirm_password:R,mobile:O,otp:c,role:k,designation:v,employeeCode:U,address:A,dateOfBirth:C,emergencyContactName:F,emergencyContactNumber:G,emergencyContactRelation:J,bankName:V,bankBranch:_,bankIfsc:D,bankAccountNumber:j,bankBeneficiaryAddress:z})=>{var h,w,b,P;s(!0);try{if(u.pathname==="/login")if(p&&l){if(!c)return s(!1),r("OTP is required!");const e=await i.verifyLoginOtp({userId:l,otp:c});e&&(n("Login successful!"),g({type:"USER_LOGIN",payload:e}),q.set("adminInfo",JSON.stringify(e),{expires:.417,sameSite:"None",secure:!0}),f(!1),d(null),m(""),y("/dashboard",{replace:!0}))}else{if(!t||!a)return s(!1),r("Email and password are required!");const e=await i.loginEmployee({email:t,password:a});e&&(e.requiresOtp?(n(e.message||"Verification code has been sent to administrators"),f(!0),d(e.userId),m(e.email),S("password","")):(n("Login Success!"),g({type:"USER_LOGIN",payload:e}),q.set("adminInfo",JSON.stringify(e),{expires:.417,sameSite:"None",secure:!0}),y("/dashboard",{replace:!0})))}if(u.pathname==="/signup"){if(!E||!t||!a||!O)return s(!1),r("Required fields are missing!");if(a!==R)return s(!1),r("Passwords do not match!");const e={name:F,number:G,relation:J},B={bankName:V,branch:_,ifsc:D,accountNumber:j,beneficiaryAddress:z},Z=await i.registerEmployee({name:E,email:t,password:a,mobile:O,role:k,employeeCode:U,designation:v,address:A,dateOfBirth:C,emergencyContact:e,bankDetails:B})}if(u.pathname==="/forgot-password"){if(!t)return s(!1),r("Email is required!");const e=await i.forgotEmployeePassword({email:t});if(e)return n(e.message||"OTP sent to your email"),e;throw new Error("Failed to send OTP")}if(u.pathname==="/reset-password"){if(!t||!c||!a)return s(!1),r("Email, OTP and password are required!");const e=await i.resetEmployeePassword({email:t,otp:c,newPassword:a});return n(e.message||"Password reset successful"),e}}catch(e){return r(((w=(h=e==null?void 0:e.response)==null?void 0:h.data)==null?void 0:w.message)||((P=(b=e==null?void 0:e.response)==null?void 0:b.data)==null?void 0:P.error)||(e==null?void 0:e.message)),!1}finally{s(!1)}},register:I,handleSubmit:T,errors:x,loading:L,otpRequired:p,userId:l,userEmail:N,resetOtpState:()=>{f(!1),d(null),m("")},setValue:S}};export{te as u};
